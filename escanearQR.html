<!DOCTYPE html>
<html>
<head>
    <title>Html-Qrcode Demo</title>
</head>
<body>
    <video id="qr-video" width="100%" height="auto"></video>
    <div id="qr-reader-results"></div>

    <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
    <script>
        function startScanner() {
            const videoElement = document.getElementById('qr-video');
            const qrResultContainer = document.getElementById('qr-reader-results');

            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                .then(function(stream) {
                    videoElement.srcObject = stream;
                    videoElement.play();

                    const videoTrack = stream.getVideoTracks()[0];
                    const imageCapture = new ImageCapture(videoTrack);

                    function scanQRCode() {
                        imageCapture.grabFrame()
                            .then(function(imageBitmap) {
                                const qrCanvas = document.createElement('canvas');
                                qrCanvas.width = imageBitmap.width;
                                qrCanvas.height = imageBitmap.height;
                                const qrCanvasContext = qrCanvas.getContext('2d');
                                qrCanvasContext.drawImage(imageBitmap, 0, 0, qrCanvas.width, qrCanvas.height);
                                const imageData = qrCanvasContext.getImageData(0, 0, qrCanvas.width, qrCanvas.height);
                                const code = jsQR(imageData.data, imageData.width, imageData.height);

                                if (code && isURL(code.data)) {
                                    console.log('QR Code:', code.data);
                                    window.location.href = code.data;
                                }

                                requestAnimationFrame(scanQRCode);
                            })
                            .catch(function(error) {
                                console.error('Error capturing video frame:', error);
                            });
                    }

                    scanQRCode();
                })
                .catch(function(error) {
                    console.error('Error accessing camera:', error);
                });
        }

        function isURL(text) {
            try {
                new URL(text);
                return true;
            } catch (_) {
                return false;
            }
        }

        document.addEventListener("DOMContentLoaded", startScanner);
    </script>
</body>
</html>
