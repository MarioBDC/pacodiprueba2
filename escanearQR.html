<!DOCTYPE html>
<html>
<head>
    <title>Html-Qrcode Demo</title>
</head>
<body>
    <video id="qr-video" width="100%" height="auto"></video>
    <div id="qr-reader-results"></div>

    <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
    <script>
        function startScanner() {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                .then(function(stream) {
                    var videoElement = document.getElementById('qr-video');
                    videoElement.srcObject = stream;
                    videoElement.play();

                    var qrCanvas = document.createElement('canvas');
                    var qrCanvasContext = qrCanvas.getContext('2d');
                    var qrResultContainer = document.getElementById('qr-reader-results');

                    function scanQRCode() {
                        qrCanvas.width = videoElement.videoWidth;
                        qrCanvas.height = videoElement.videoHeight;
                        qrCanvasContext.drawImage(videoElement, 0, 0, qrCanvas.width, qrCanvas.height);

                        var imageData = qrCanvasContext.getImageData(0, 0, qrCanvas.width, qrCanvas.height);
                        var code = jsQR(imageData.data, imageData.width, imageData.height);

                        if (code && isURL(code.data)) {
                            console.log('QR Code:', code.data);
                            window.location.href = code.data;
                        }

                        requestAnimationFrame(scanQRCode);
                    }

                    scanQRCode();
                })
                .catch(function(error) {
                    console.error('Error accessing camera:', error);
                });
        }

        function isURL(text) {
            try {
                new URL(text);
                return true;
            } catch (_) {
                return false;
            }
        }

        document.addEventListener("DOMContentLoaded", startScanner);
    </script>
</body>
</html>

